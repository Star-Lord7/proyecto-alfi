generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

model Tarjeta {
  id          Int                @id @default(autoincrement())
  pregunta    String
  imagen      String?
  dificultad  NivelDificultad
  estado      EstadoTarjeta
  coleccionId Int
  created_at  DateTime           @default(now())
  updated_at  DateTime           @updatedAt
  deleted_at  DateTime?
  opciones    OpcionRespuesta[]
  respuestas  RespuestaUsuario[]
  coleccion   Coleccion          @relation(fields: [coleccionId], references: [id])

  @@index([coleccionId], map: "tarjetas_coleccionId_fkey")
  @@map("tarjetas")
}

model Coleccion {
  id                Int              @id @default(autoincrement())
  titulo            String
  descripcion       String?
  cantidad_tarjetas Int
  estado            Boolean          @default(true)
  temaId            Int
  created_at        DateTime         @default(now())
  updated_at        DateTime         @updatedAt
  deleted_at        DateTime?
  tema              Tema             @relation(fields: [temaId], references: [id])
  puntajes          PuntajeUsuario[]
  tarjetas          Tarjeta[]

  @@index([temaId], map: "colecciones_temaId_fkey")
  @@map("colecciones")
}

model Tema {
  id          Int         @id @default(autoincrement())
  nombre      String      @unique
  descripcion String?
  estado      Boolean     @default(true)
  created_at  DateTime    @default(now())
  updated_at  DateTime    @updatedAt
  deleted_at  DateTime?
  colecciones Coleccion[]

  @@map("temas")
}

model OpcionRespuesta {
  id              Int                @id @default(autoincrement())
  descripcion     String
  feedback        String?
  es_correcta     Boolean
  puntos          Int
  tarjetaId       Int
  created_at      DateTime           @default(now())
  updated_at      DateTime           @updatedAt
  deleted_at      DateTime?
  tarjeta         Tarjeta            @relation(fields: [tarjetaId], references: [id])
  opcionesUsuario RespuestaUsuario[]

  @@index([tarjetaId], map: "opciones_respuesta_tarjetaId_fkey")
  @@map("opciones_respuesta")
}

model RespuestaUsuario {
  id              Int             @id @default(autoincrement())
  tarjetaId       Int
  opcionId        Int
  puntajeId       Int
  tiempoRespuesta Int
  esCorrecta      Boolean
  created_at      DateTime        @default(now())
  updated_at      DateTime        @updatedAt
  deleted_at      DateTime?
  opcion          OpcionRespuesta @relation(fields: [opcionId], references: [id])
  puntaje         PuntajeUsuario  @relation(fields: [puntajeId], references: [id])
  tarjeta         Tarjeta         @relation(fields: [tarjetaId], references: [id])

  @@index([opcionId], map: "respuestas_usuario_opcionId_fkey")
  @@index([puntajeId], map: "respuestas_usuario_puntajeId_fkey")
  @@index([tarjetaId], map: "respuestas_usuario_tarjetaId_fkey")
  @@map("respuestas_usuario")
}

model PuntajeUsuario {
  id           Int                @id @default(autoincrement())
  perfilId     Int
  coleccionId  Int
  puntajeFinal Int
  created_at   DateTime           @default(now())
  updated_at   DateTime           @updatedAt
  deleted_at   DateTime?
  coleccion    Coleccion          @relation(fields: [coleccionId], references: [id])
  perfil       Perfil             @relation(fields: [perfilId], references: [id])
  respuestas   RespuestaUsuario[]

  @@index([coleccionId], map: "puntajes_usuario_coleccionId_fkey")
  @@index([perfilId], map: "puntajes_usuario_perfilId_fkey")
  @@map("puntajes_usuario")
}

model Perfil {
  id              Int              @id @default(autoincrement())
  nombre          String
  apellido        String
  edad            Int?
  telefono        String?
  estado          Boolean          @default(true)
  usuarioId       Int
  paisId          Int
  segmentoId      Int
  created_at      DateTime         @default(now())
  updated_at      DateTime         @updatedAt
  deleted_at      DateTime?
  pais            Pais             @relation(fields: [paisId], references: [id])
  segmento        Segmento         @relation(fields: [segmentoId], references: [id])
  usuario         Usuario          @relation(fields: [usuarioId], references: [id])
  puntajeUsuarios PuntajeUsuario[]

  @@index([paisId], map: "perfiles_paisId_fkey")
  @@index([segmentoId], map: "perfiles_segmentoId_fkey")
  @@index([usuarioId], map: "perfiles_usuarioId_fkey")
  @@map("perfiles")
}

model Usuario {
  id         Int       @id @default(autoincrement())
  email      String    @unique
  password   String
  rol        Rol       @default(USUARIO)
  estado     Boolean   @default(true)
  created_at DateTime  @default(now())
  updated_at DateTime  @updatedAt
  deleted_at DateTime?
  perfiles   Perfil[]
  token      token[]

  @@map("usuarios")
}

model Segmento {
  id          Int       @id @default(autoincrement())
  nombre      String    @unique
  descripcion String?
  estado      Boolean   @default(true)
  created_at  DateTime  @default(now())
  updated_at  DateTime  @updatedAt
  deleted_at  DateTime?
  perfiles    Perfil[]

  @@map("segmentos")
}

model Pais {
  id         Int       @id @default(autoincrement())
  nombre     String    @unique
  estado     Boolean   @default(true)
  created_at DateTime  @default(now())
  updated_at DateTime  @updatedAt
  deleted_at DateTime?
  perfiles   Perfil[]

  @@map("paises")
}

model token {
  id         Int      @id @default(autoincrement())
  token      String   @unique(map: "Token_token_key")
  usuarioId  Int
  created_at DateTime @default(now())
  usuarios   Usuario  @relation(fields: [usuarioId], references: [id], map: "Token_usuarioId_fkey")

  @@index([usuarioId], map: "Token_usuarioId_fkey")
}

enum EstadoTarjeta {
  PENDIENTE_REVISION
  APROBADA
  RECHAZADA
}

enum NivelDificultad {
  BASICO
  INTERMEDIO
  AVANZADO
}

enum Rol {
  SUPERADMIN
  ADMIN
  USUARIO
}
